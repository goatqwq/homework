# 1.什么是自顶向下的编程方法

当我们在写程设作业的时候，遇到一个比较难的需求时，为了简化问题，我们会将所需要的步骤分割开来，变成一个一个模组（module），将其编写成函数，最终达到“主函数简洁、清晰、明了、完成需求”的目的。
上述过程中便用到了自顶向下的编程方法。
那么，自顶向下的编程方法是什么？
自顶向下，便是对要完成的任务进行分解，先对最高层次中的问题进行定义、设计、编程和测试，而将其中未解决的问题作为一个子任务放到下一层次中去解决。这样逐层、逐个地进行定义、设计、编程和测试，直到所有层次上的问题均由实用程序来解决。

![](images/1541932203(1).png)

# 2.生活中的案例——洗衣机

一般来说，洗衣分为好几个模式：标准、快洗、精洗等。在这些模式下，步骤都有注水，浸洗，洗涤，漂洗，脱水等大步骤。
```
注水：用户选择注水量或自动判断注水量
洗涤：直筒旋转，使衣物与筒壁摩擦
浸洗：浸泡衣物
漂洗：排水，再次注水，直筒旋转，洗出残余洗涤剂，排水
脱水：直筒高速旋转，将衣物中的水排出
```
将结构分解成大步骤后，发现还有许多细节问题，于是将大步骤分解成为小步骤。

## 细节问题：
```
Q:如何判断水位到达目标水位？
A:使用传感器判断水位，并与设定的水位相比较

Q:如何自动判断注水量？
A:使用传感器接收衣物重量，并通过特定公式计算所需水量

Q:如何判断浸泡时间？
A:根据衣物重量，使用特定公式计算所需浸泡时间

Q:如何判断洗涤剂已经清洗干净？
A:传感器检测水中的ph值，如果ph值在某个区间，则判断为清洗干净

Q:如何判断脱水完成？
A:重量传感器接受筒内重量，若上一次脱水前后重量差距小于一定值，则判断脱水完成

Q:如果洗衣过程中打开洗衣机盖，该如何操作？
A:传感器接受盖子是否打开。如果在注水和浸洗过程中打开，那么维持操作不便；如果是在漂洗、洗涤、脱水过程中打开，则暂停所有操作，并发出提示音
```
于是，可以写出正常清洗的伪代码：

先写相关模块：
```
注水:
water_out_switch(close)
READ 预定水位
水位 = get_water_volume()//通过传感器获取水位
WHILE 水位 != 预定水位
    water_in_switch(open)
    水位 = get_water_volume()//实时获取水位
ENDWHILE
water_in_switch(close)

排水：
water_in_switch(close)
水位 = get_water_volume()
WHILE 水位 != 0
    water_out_switch(open)
    水位 = get_water_volume()
ENDWHILE
water_out_switch(close)

筒旋转:
motor_run(left)//左旋转
wait(3)//等3秒
moter_run(right)//右旋转
wait(3)
```
通过使用前面的模块，写出一次正常清洗的伪代码：
```
HALT(failure)//停机失败，即开机
衣物重量 = get_weight()//获取衣物重量
READ 目标水位
IF 目标水位 == NUL THEN//没有接收到用户的输入
    预定水位 = compute_water_from_weight(衣物重量)//通过特定公式计算所需水量
ELSE
    预定水位 = 目标水位
ENDIF
注水//注水步骤
wait(5min)//浸泡步骤，时间5分钟

//漂洗开始
次数 = 5
WHILE 次数 != 0
    筒旋转
    次数 -= 1
ENDWHILE
ph值 = get_ph()//获取水中ph
排水
//漂洗结束

//洗涤开始
WHILE ph值 不属于 预定区间
    注水
    筒旋转
    筒旋转
    筒旋转
    筒旋转
    ph值 = get_ph()
    排水
ENDWHILE
//洗涤结束

//脱水开始
前一次重量 = get_weight()
REPEAT
    注水
    筒旋转
    筒旋转
    筒旋转
    筒旋转
    筒旋转
    排水
    重量差距 = 前一次重量 - get_weight()
    IF 重量差距 在 预定区间内 THEN
        BREAK
    ELSE
        前一次重量 = gat_weight()
    ENDIF
ENDREPEAT
//脱水结束

//停机并发出提示
halt(sucess)
发出提示音(10s)
//结束
```